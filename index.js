const rp = require('request-promise');
const fs = require('fs')
const $ = require('cheerio');
const resultParse = require('./resultParse');
const webpageParse = require('./webpageParse');
const url = 'https://www.amazon.com/s/rstripbooks&ie=UTF8&keywords=';

rp(url)
  .then(function(html) {
    //success!

    const isbnArray = [9780553381153];
    // const isbnArray = [
    //   9781889140438,
    //   9780061246562,
    //   9780195325263,
    //   9780306820205,
    //   9780310338130,
    //   9780310357797,
    //   9780345305831,
    //   9780439705448,
    //   9780449901427,
    //   9780452279094,
    //   9780521004640,
    //   9780529100733,
    //   9780553393071,
    //   9780671631987,
    //   9780674066137,
    //   9780684863177,
    //   9780692587713,
    //   9780718031824,
    //   9780718097028,
    //   9780736915731,
    //   9780736917728,
    //   9780736928663,
    //   9780736958400,
    //   9780736959315,
    //   9780736970372,
    //   9780756625054,
    //   9780758647757,
    //   9780764203749,
    //   9780764212246,
    //   9780800720339,
    //   9780800723132,
    //   9780800723491,
    //   9780800724917,
    //   9780800729110,
    //   9780800759902,
    //   9780801018978,
    //   9780805041569,
    //   9780805211122,
    //   9780805430530,
    //   9780805446661,
    //   9780811868952,
    //   9780830773084,
    //   9780842321624,
    //   9780849964541,
    //   9780849964756,
    //   9780877883548,
    //   9780996271691,
    //   9781400023349,
    //   9781400204663,
    //   9781400318735,
    //   9781414388229,
    //   9781414391328,
    //   9781433523694,
    //   9781433547805,
    //   9781433680731,
    //   9781434764478,
    //   9781440505362,
    //   9781452102511,
    //   9781478974673,
    //   9781496403377,
    //   9781496405296,
    //   9781501118739,
    //   9781533498809,
    //   9781548921811,
    //   9781557091031,
    //   9781581349412,
    //   9781589978669,
    //   9781595555090,
    //   9781596059436,
    //   9781596381353,
    //   9781599956831,
    //   9781628362442,
    //   9781629987286,
    //   9781782491156,
    //   9781783091591,
    //   9781783097562,
    //   9781847691064,
    //   9781857885262,
    //   9781879264106,
    //   9781879341005,
    //   9781888692136,
    //   9781935071273,
    //   9781939754684,
    //   9781980381709,
    //   978310331674,
    //   9784908629013,
    //   9788830350502,
    //   9789526803708,
    //   9781558320383,
    //   9780062072221,
    //   9780316393843,
    //   9780671027629,
    //   'B001TKTQ1Y',
    //   'B00FFBAJUA',
    //   9781889392202,
    //   9780743476676,
    //   9780743219341,
    //   9780061173547,
    //   9780743251549,
    //   9780195115017,
    //   9781496426666,
    //   9781451618006,
    //   9781583229279,
    //   9780965987301,
    //   9780310243151,
    //   9780979777769,
    //   9780449010884,
    //   9780307987280,
    //   9781430063353,
    //   9780990592808,
    //   9781932279177,
    //   9780972304641,
    //   'B004XWDD8W',
    //   9781594204753,
    //   9781629953571,
    //   9780470471944,
    //   9781400201662,
    //   9781433520099,
    //   9780849905483,
    //   9780763600136,
    //   9780800732769,
    //   9780449004029,
    //   9780345473028,
    //   9780312318321,
    //   9780375760280,
    //   9780547564654,
    //   'B01HZFB4WU',
    //   9781627791779,
    //   9780380811960,
    //   9781501131653,
    //   9781476735139,
    //   9780553381153,
    //   9780062231857,
    //   9780988995840,
    //   9781565125223,
    //   9780201550917,
    //   'B01N34V250',
    //   9781938170157,
    //   9781416528630,
    //   9781930429000,
    //   9780920668375,
    //   9780060746377,
    //   9781561487509,
    //   9780061732324,
    //   // 9780525537,
    //   9781499351118,
    //   'B00JCS4NMC',
    //   9780446504126,
    //   9781501122989,
    //   9781932740080,
    //   9781400079094,
    //   9780609806937,
    //   9781585422951,
    //   9781576839546,
    //   9781583334553,
    //   9781433551932,
    //   9780399160288,
    //   9780345442864,
    //   9780345487674,
    //   'B071VM4SKW',
    //   9780743212410,
    //   9780738210735,
    //   9780684838656,
    //   9780060739669,
    //   9780345479099,
    //   9780966378603,
    //   9780393342215,
    //   9780345507976,
    //   9780615619200,
    //   9781570671043,
    //   9781250105585,
    //   9780062326034,
    //   9781492602750,
    //   9780345518064,
    //   9780316778091,
    //   9780316778008,
    //   9781931686235,
    //   9780743488945,
    //   9780142196007,
    //   9780375710476,
    //   9781897238455,
    //   9780028740171,
    //   9780060779399,
    //   9781617691836,
    //   9781881273653,
    //   9780988995833,
    //   9781416524724,
    //   9780805099430,
    //   9780553588729,
    //   9780553381436,
    //   9781476733715,
    //   9781501146671,
    //   9780992389109,
    //   9780316159951,
    //   9780091948115,
    //   9780091948115,
    //   9780789208156,
    //   9781414313634,
    //   9780071381390,
    //   9781558323049,
    //   'B00KAC65PW',
    //   9780061778735,
    //   9780399525179,
    //   9780553807912,
    //   9780452285804,
    //   9780824525385,
    //   9780738210490,
    //   9780988995819,
    //   9780743487481,
    //   'B07BQGHPTL',
    //   978761181507,
    //   9780761121329,
    //   9780805835595,
    //   9780800731915,
    //   9780375700002,
    //   9781889140162,
    // ];
    return Promise.all(
      isbnArray.map(isbns => resultParse(url + isbns, isbns))
    );
    // return rp('https://www.goodreads.com/book/title.xml?key=yXZIGleYDqexQC7C40PFg&title=9781782491156')
    // .then(function(html) {
    //   console.log(html)
    // })
  })
  .then(results => {
    //results.map(result => webpageParse(result.href))
    fs.writeFile('data.json', JSON.stringify(results), err => {
      if (err) return console.log(err)
      console.log('saved')
    })
    console.log(results);
  })
  .catch(err => {
    //handle error
    console.log(err);
  });